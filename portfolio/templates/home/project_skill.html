<!-- Featured Projects from Database -->
{% load static %}
<link rel="stylesheet" href="{% static 'css/project_skill.css' %}">
{% if featured_projects %}
<section id="work">
  <div class="sec-head">
    <h2>Projects</h2>
  </div>
  
  <!-- Projects Container with Carousel Support -->
  <div class="projects-container">
    <div class="projects-grid">
      {% for project in featured_projects %}
        <div class="project-card" data-project-id="{{project.id}}">
          <!-- Project Image Section -->
          <div class="project-image">
            {% if project.image %}
              <img src="{{project.image.url}}" alt="{{project.title}} preview" loading="lazy">
            {% else %}
              <div class="project-placeholder-image">
                <i class="fas fa-image"></i>
              </div>
            {% endif %}
            <div class="project-overlay">
              <div class="project-color-bar" style="background-color: {% cycle '#6c757d' '#007bff' '#fd7e14' '#28a745' '#dc3545' '#6f42c1' %}"></div>
            </div>
          </div>
          
          <!-- Project Content -->
          <div class="project-content">
            <div class="project-card-header">
              <h3>{{project.title}}</h3>
            </div>
            
            <div class="project-description">
              <ul>
                {% if project.short_description %}
                  <li>{{project.short_description}}</li>
                {% endif %}
                {% if project.technologies %}
                  <li><strong>Technologies:</strong> {{project.technologies}}</li>
                {% endif %}
                {% if project.status %}
                  <li><strong>Status:</strong> {{project.status|title}}</li>
                {% endif %}
              </ul>
            </div>
            
            <div class="project-links">
              {% if project.live_demo_url %}
                <a href="{{project.live_demo_url}}" target="_blank" class="project-btn" rel="noopener">
                  <i class="fas fa-external-link-alt"></i>
                  Live Demo
                </a>
              {% endif %}
              {% if project.github_url %}
                <a href="{{project.github_url}}" target="_blank" class="project-btn" rel="noopener">
                  <i class="fab fa-github"></i>
                  Source Code
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Carousel Navigation for Mobile -->
    <div class="carousel-nav">
      <button class="carousel-btn carousel-prev" aria-label="Previous project">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div class="carousel-dots">
        {% for project in featured_projects %}
          <button class="carousel-dot {% if forloop.first %}active{% endif %}" 
                  data-slide="{{forloop.counter0}}" 
                  aria-label="Go to project {{forloop.counter}}"></button>
        {% endfor %}
      </div>
      <button class="carousel-btn carousel-next" aria-label="Next project">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</section>
{% endif %}

<!-- All Skills from Database -->
{% if featured_skills %}
<section>
  <div class="sec-head">
    <h2>My Skills</h2>
  </div>
<div class="skills-grid-ios">
    {% for skill in featured_skills %}
      <div class="skill-app-icon">
        <div class="skill-icon-circle">
          {% if skill.icon %}
            <img src="{% static 'images/icons/' %}{{skill.icon}}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'python' %}
            <img src="{% static 'images/icons/python.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'django' %}
            <img src="{% static 'images/icons/django.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'javascript' %}
            <img src="{% static 'images/icons/javascript.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'mysql' %}
            <img src="{% static 'images/icons/mysql2.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'html/css' %}
            <img src="{% static 'images/icons/html.png' %}" alt="{{skill.name}}" class="skill-custom-image">
    
          {% elif skill.name|lower == 'excel' %}
            <img src="{% static 'images/icons/excel.png' %}" alt="{{skill.name}}" class="skill-custom-image">

          {% elif skill.name|lower == 'git/github' %}
            <img src="{% static 'images/icons/github.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'vscode' %}
            <img src="{% static 'images/icons/vscode.png' %}" alt="{{skill.name}}" class="skill-custom-image">

          {% elif skill.name|lower == 'genai' %}
            <img src="{% static 'images/icons/GenAi.png' %}" alt="{{skill.name}}" class="skill-custom-image">

               {% elif skill.name|lower == 'word' %}
            <img src="{% static 'images/icons/word.png' %}" alt="{{skill.name}}" class="skill-custom-image">

          {% elif skill.name|lower == 'etl processes' %}
            <img src="{% static 'images/icons/etl.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'problem solving' %}
            <img src="{% static 'images/icons/problem.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'customer service' %}
            <img src="{% static 'images/icons/customer.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% elif skill.name|lower == 'team collaboration' %}
            <img src="{% static 'images/icons/collab.png' %}" alt="{{skill.name}}" class="skill-custom-image">
             
            {% elif skill.name|lower == 'documentation' %}
            <img src="{% static 'images/icons/documentation.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          
            {% else %}
            <img src="{% static 'images/icons/default.png' %}" alt="{{skill.name}}" class="skill-custom-image">
          {% endif %}
        </div>
        <div class="skill-name-ios">{{skill.name}}</div>
      </div>
    {% endfor %}
</div>

</section>

<!-- Carousel JavaScript for Mobile -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const projectsGrid = document.querySelector('.projects-grid');
  const dots = document.querySelectorAll('.carousel-dot');
  const prevBtn = document.querySelector('.carousel-prev');
  const nextBtn = document.querySelector('.carousel-next');
  const projectCards = document.querySelectorAll('.project-card');
  const carouselNav = document.querySelector('.carousel-nav');
  
  if (!projectsGrid || !projectCards.length) return;
  
  let currentSlide = 0;
  const totalSlides = projectCards.length;
  let isCarouselMode = false;
  
  // Check if we should use carousel mode based on screen size
  function checkCarouselMode() {
    const isMobile = window.innerWidth <= 768;
    const shouldUseCarousel = isMobile && totalSlides > 1;
    
    if (shouldUseCarousel !== isCarouselMode) {
      isCarouselMode = shouldUseCarousel;
      toggleCarouselMode();
    }
  }
  
  function toggleCarouselMode() {
    if (isCarouselMode) {
      // Switch to horizontal scrolling carousel for mobile
      projectsGrid.style.display = 'flex';
      projectsGrid.style.overflowX = 'auto';
      projectsGrid.style.scrollSnapType = 'x mandatory';
      projectsGrid.style.scrollbarWidth = 'none';
      projectsGrid.style.msOverflowStyle = 'none';
      projectsGrid.style.webkitScrollbar = 'none';
      
      // Set card widths for mobile carousel
      projectCards.forEach(card => {
        card.style.minWidth = 'calc(100vw - 40px)';
        card.style.maxWidth = 'calc(100vw - 40px)';
        card.style.flexShrink = '0';
        card.style.scrollSnapAlign = 'start';
        card.style.marginRight = '16px';
      });
      
      if (carouselNav) carouselNav.style.display = 'flex';
    } else {
      // Switch to grid layout for desktop/tablet
      projectsGrid.style.display = 'grid';
      projectsGrid.style.overflowX = 'visible';
      projectsGrid.style.scrollSnapType = 'none';
      
      // Reset card styles
      projectCards.forEach(card => {
        card.style.minWidth = '';
        card.style.maxWidth = '';
        card.style.flexShrink = '';
        card.style.scrollSnapAlign = '';
        card.style.marginRight = '';
      });
      
      if (carouselNav) carouselNav.style.display = 'none';
    }
  }
  
  function updateCarousel() {
    if (!isCarouselMode) return;
    
    // Update dots
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
    
    // Scroll to the current card
    if (projectCards[currentSlide]) {
      const targetCard = projectCards[currentSlide];
      const scrollLeft = targetCard.offsetLeft - (projectsGrid.offsetWidth - targetCard.offsetWidth) / 2;
      
      projectsGrid.scrollTo({
        left: scrollLeft,
        behavior: 'smooth'
      });
    }
  }
  
  function nextSlide() {
    if (!isCarouselMode) return;
    currentSlide = (currentSlide + 1) % totalSlides;
    updateCarousel();
  }
  
  function prevSlide() {
    if (!isCarouselMode) return;
    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
    updateCarousel();
  }
  
  // Event listeners
  if (nextBtn) {
    nextBtn.addEventListener('click', nextSlide);
  }
  
  if (prevBtn) {
    prevBtn.addEventListener('click', prevSlide);
  }
  
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      if (!isCarouselMode) return;
      currentSlide = index;
      updateCarousel();
    });
  });
  
  // Touch/swipe support for mobile
  let startX = 0;
  let endX = 0;
  let isDragging = false;
  
  projectsGrid.addEventListener('touchstart', (e) => {
    if (!isCarouselMode) return;
    startX = e.touches[0].clientX;
    isDragging = true;
  }, { passive: true });
  
  projectsGrid.addEventListener('touchmove', (e) => {
    if (!isCarouselMode || !isDragging) return;
    // Allow normal scrolling behavior
  }, { passive: true });
  
  projectsGrid.addEventListener('touchend', (e) => {
    if (!isCarouselMode || !isDragging) return;
    endX = e.changedTouches[0].clientX;
    handleSwipe();
    isDragging = false;
  }, { passive: true });
  
  function handleSwipe() {
    const swipeThreshold = 80; // Increased threshold for better UX
    const diff = startX - endX;
    
    if (Math.abs(diff) > swipeThreshold) {
      if (diff > 0) {
        nextSlide(); // Swipe left - go to next
      } else {
        prevSlide(); // Swipe right - go to previous
      }
    }
  }
  
  // Update current slide based on scroll position
  function updateSlideFromScroll() {
    if (!isCarouselMode) return;
    
    const scrollLeft = projectsGrid.scrollLeft;
    const cardWidth = projectCards[0]?.offsetWidth || 0;
    const gap = 16; // Gap between cards
    const newSlide = Math.round(scrollLeft / (cardWidth + gap));
    
    if (newSlide !== currentSlide && newSlide >= 0 && newSlide < totalSlides) {
      currentSlide = newSlide;
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
      });
    }
  }
  
  // Throttled scroll listener
  let scrollTimeout;
  projectsGrid.addEventListener('scroll', () => {
    if (scrollTimeout) clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(updateSlideFromScroll, 100);
  }, { passive: true });
  
  // Resize listener
  let resizeTimeout;
  window.addEventListener('resize', () => {
    if (resizeTimeout) clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      checkCarouselMode();
      if (isCarouselMode) {
        updateCarousel();
      }
    }, 150);
  });
  
  // Initial setup
  checkCarouselMode();
  
  // Hide scrollbar for webkit browsers
  const style = document.createElement('style');
  style.textContent = `
    .projects-grid::-webkit-scrollbar {
      display: none;
    }
  `;
  document.head.appendChild(style);
});
</script>
{% endif %}